<!DOCTYPE html>
<html>
  <head>
    {{$title := .Value.Title}}
    {{$value := .}}
    {{$prefix := $value.Join "/movies/" $title}}
    <title>{{$title}}</title>
    <link rel="stylesheet" href="/css/movie.css">
  </head>
  <body>
    <p><a href="/">Home</a></p>
    {{$releaseDate := $value.Date .Value.ReleaseDate}}
    <table>
      <tr>
        <td valign="top">
          <img src="{{.Value.Image}}" align="bottom">
        </td>
        <td valign="top">
          <div>
            <span class="title">{{$title}}</span>
            <span class="date">({{$releaseDate.Year}})</span>
            <span class="genre">{{.Value.Genre}}</span>
            <p>
              {{$director := $value.Get "Director"}}
              {{$path := $value.Join $value.Name "Director"}}
              Director: <a href="{{$path}}">{{$director.Name}}</a>
            </p>
          </div>
        </td>
      </tr>
    </table>

    <!-- Table to display the cast -->
    {{with $value.Glob "Cast/*"}}
    <div class="castbox">
      <h2>Cast</h2>
      <table class="cast">
        {{range .}}
        <tr> <!-- . = /Cast/pXX -->
          {{$part := $value.Get .}}
          {{$actorRelativePath := $value.Join . "Actor"}}
          {{$actor := $value.Get $actorRelativePath}}
          {{$path := $value.Join "/people/" $actor.Name}}
          <td class="castactor">
            <a href="{{$path}}">{{$actor.Name}}</a>
          </td>
          <td class="castchar">{{$part.Character}}</td>
        </tr>
        {{end}}
      </table>
    </div>
    {{end}}

    <!-- Reviews -->
    {{with $value.Glob "Reviews/*"}}
    <h2>Reviews</h2>
    {{range .}}
    {{$review := $value.Get .}}
    <div class="reviewbox">
      <p><span class="rating">Rating: {{$review.Rating}}/10</span></p>
      <p><span class="reviewtext">{{$review.Text}}</span></p>
    </div>
    {{end}}
    {{end}}

    <!-- Debugging -->
    <span class="debug">{{.Name}} <a href="?raw">Raw</a></span>
  </body>
</html>
